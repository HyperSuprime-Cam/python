#!/bin/bash

set -e

# Check the version of python at the front of $PATH
PYTHON="python"

# Check if a supported $PYTHON executable exists
# Eligible versions are listed at # https://confluence.lsstcorp.org/display/LSWUG/_PythonVersionSupport
if hash "$PYTHON" 2>/dev/null; then
	# Use full path from now on as it makes messages clearer
	PYTHON=$(which $PYTHON)
	PYTHON_VERSION=$($PYTHON -c 'import sys; print("{}.{:02d}".format(sys.version_info[0], sys.version_info[1]))')
	MINVER=2.7
	MINVER3=3.5
	# bc is used to do floating point comparisons
	if [ $(bc <<< "$PYTHON_VERSION < $MINVER || ($PYTHON_VERSION > 3.0 && $PYTHON_VERSION < $MINVER3)") -eq 1 ]; then
		echo "check-python: Python2 >= $MINVER or Python3 >= $MINVER3 not found (version reported by '$PYTHON' is $PYTHON_VERSION)." 2>&1
		echo "check-python: Please ensure a compatible python is at the front of your PATH." 2>&1
		exit -1
	fi
else
	echo "check-python: no python executable detected (looked for '$PYTHON')." 2>&1
	exit -1
fi

echo "Using $PYTHON ($($PYTHON -V 2>&1))."
# echo "Located in $(which $PYTHON)"

exit 0
